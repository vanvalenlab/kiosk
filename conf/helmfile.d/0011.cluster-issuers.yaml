helmDefaults:
  wait: true
  timeout: 600
  force: true

################################################################################
## Cluster Issuers #############################################################
################################################################################

repositories:
    # Kubernetes incubator repo of helm charts
  - name: incubator
    url: https://charts.helm.sh/incubator

releases:

#
# Certificate Issuers
- name: cert-manager-issuers
  namespace: cert-manager
  chart: incubator/raw
  atomic: true
  cleanupOnFail: true
  force: true
  values:
    - resources:

      - apiVersion: cert-manager.io/v1
        kind: ClusterIssuer
        metadata:
          name: letsencrypt-staging
        spec:
          acme:
            server: https://acme-staging-v02.api.letsencrypt.org/directory
            privateKeySecretRef:
              name: letsencrypt-staging
            solvers:
            - selector: {}
              dns01:
                cloudDNS:
                  project: {{ env "CLOUDSDK_CORE_PROJECT" | default "project-not-found" }}
                  serviceAccountSecretRef:
                    name: clouddns-dns01-solver-svc-acct
                    key: key.json

      - apiVersion: cert-manager.io/v1
        kind: ClusterIssuer
        metadata:
          name: letsencrypt-prod
        spec:
          acme:
            server: https://acme-v02.api.letsencrypt.org/directory
            privateKeySecretRef:
              name: letsencrypt-prod
            solvers:
            - selector: {}
              dns01:
                cloudDNS:
                  project: {{ env "CLOUDSDK_CORE_PROJECT" | default "project-not-found" }}
                  serviceAccountSecretRef:
                    name: clouddns-dns01-solver-svc-acct
                    key: key.json
